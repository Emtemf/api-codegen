# Swagger 2.0 示例 - 包含所有校验规则场景
#
# 本文件故意包含各种校验问题，用于测试和演示校验分析功能
# 加载此文件后，系统会自动检测并给出修复建议
#
# 校验规则场景：
# - DFX-001: 路径包含 // (已包含)
# - DFX-002: 路径不以 / 开头 (已包含)
# - DFX-003: 必填参数缺少 @NotNull/@NotBlank (已包含)
# - DFX-004: String字段缺少长度校验 (已包含)
# - DFX-005: 邮箱字段缺少格式校验 (已包含)
# - DFX-006: 电话字段缺少正则校验 (已包含)
# - DFX-007: 数值字段缺少范围校验 (已包含)
# - DFX-008: List字段缺少大小校验 (已包含)
# - DFX-009: minLength > maxLength (已包含)
# - DFX-010: min > max (已包含)
# - DFX-011: page参数缺少范围校验 (已包含)
# - DFX-012: pageSize参数缺少范围校验 (已包含)
# - DFX-014: 路径参数缺少最小值校验 (已包含)
# - DFX-020: 注解位置一致性校验 (已包含)
# - WARN: 必填参数缺少 description (已包含)
# - INFO: 邮箱/电话/生日/预约字段优化建议 (已包含)

swagger: '2.0'
info:
  version: v1
  title: 用户管理 API - 完整校验示例
  description: 包含所有校验规则场景的测试API
  contact:
    name: API Support
    email: support@example.com

basePath: /api/v1

# ========== definitions - 用于测试字段级别变更 ==========
# 注意：这里的字段故意缺少校验规则，用于测试"字段变更"功能
definitions:
  UserModel:
    type: object
    description: 用户模型
    properties:
      id:
        type: integer
        description: 用户ID
      username:
        type: string
        description: 用户名
      email:
        type: string
        description: 邮箱
      phone:
        type: string
        description: 手机号
      age:
        type: integer
        description: 年龄
      tags:
        type: array
        items:
          type: string
        description: 标签

paths:
  # ========== 正常API - 作为对比 ==========
  /users:
    get:
      summary: 获取用户列表 - 完整示例
      description: 分页获取用户列表，支持按用户名搜索
      operationId: getUserList
      parameters:
        - name: page
          in: query
          required: true
          description: 页码
          schema:
            type: integer
            minimum: 1
            maximum: 2147483647
        - name: pageSize
          in: query
          required: true
          description: 每页数量
          schema:
            type: integer
            minimum: 1
            maximum: 100
        - name: keyword
          in: query
          description: 搜索关键词
          schema:
            type: string
            minLength: 1
            maxLength: 255
        - name: orderBy
          in: query
          description: 排序字段
          schema:
            type: string
            minLength: 1
            maxLength: 50
      responses:
        '200':
          description: 成功

  # ========== DFX-001: 路径包含 // ==========
  /XXX/users/detail:
    get:
      summary: 用户详情 - 路径问题
      operationId: getUserDetail
      parameters:
        - name: id
          in: query
          required: true
      responses:
        '200':
          description: Success

  # ========== DFX-002: 路径不以 / 开头 ==========
  users/profile:
    get:
      summary: 用户资料 - 路径问题
      operationId: getUserProfile
      responses:
        '200':
          description: Success

  # ========== DFX-003: 必填参数缺少 @NotNull ==========
  /api/userInfo:
    get:
      summary: 获取用户信息 - 必填参数问题
      operationId: getUserInfo
      parameters:
        - name: userId
          in: query
          required: true
          description: 用户ID
          schema:
            type: integer
            # 缺少 minimum: 1
      responses:
        '200':
          description: 成功

  # ========== DFX-004: String字段缺少长度校验 ==========
  /api/search:
    get:
      summary: 搜索 - String长度校验问题
      operationId: search
      parameters:
        - name: keyword
          in: query
          description: 搜索关键词
          schema:
            type: string
            # 缺少 minLength/maxLength
      responses:
        '200':
          description: 成功

  # ========== DFX-005: 邮箱字段缺少格式校验 ==========
  /api/verifyEmail:
    post:
      summary: 验证邮箱 - 邮箱校验问题
      operationId: verifyEmail
      parameters:
        - name: email
          in: query
          required: true
          description: 邮箱地址
          schema:
            type: string
            # 有format但没有其他校验
      responses:
        '200':
          description: 成功

  # ========== DFX-006: 电话字段缺少正则校验 ==========
  /api/sendSms:
    post:
      summary: 发送短信 - 电话校验问题
      operationId: sendSms
      parameters:
        - name: phone
          in: query
          required: true
          description: 手机号
          schema:
            type: string
            # 缺少 pattern
      responses:
        '200':
          description: 成功

  # ========== DFX-007: 数值字段缺少范围校验 ==========
  /api/score:
    get:
      summary: 获取评分 - 数值范围问题
      operationId: getScore
      parameters:
        - name: score
          in: query
          description: 评分
          schema:
            type: number
            # 缺少 minimum/maximum
      responses:
        '200':
          description: 成功

  # ========== DFX-008: List字段缺少大小校验 ==========
  /api/tags:
    post:
      summary: 设置标签 - List大小问题
      operationId: setTags
      parameters:
        - name: tags
          in: query
          description: 标签列表
          schema:
            type: array
            items:
              type: string
            # 缺少 minItems/maxItems
      responses:
        '200':
          description: 成功

  # ========== DFX-011: page参数缺少范围校验 ==========
  /api/list:
    get:
      summary: 列表查询 - 分页问题
      operationId: listItems
      parameters:
        - name: page
          in: query
          description: 页码
          schema:
            type: integer
            # 缺少 minimum: 1, maximum: 2147483647
        - name: pageNum
          in: query
          description: 页码2
          schema:
            type: integer
            # 缺少 minimum: 1, maximum: 2147483647
      responses:
        '200':
          description: 成功

  # ========== DFX-012: pageSize参数缺少范围校验 ==========
  /api/list2:
    get:
      summary: 列表查询2 - 分页大小问题
      operationId: listItems2
      parameters:
        - name: limit
          in: query
          description: 限制数量
          schema:
            type: integer
            # 缺少 minimum: 1, maximum: 100
        - name: size
          in: query
          description: 大小
          schema:
            type: integer
            # 缺少 minimum: 1, maximum: 100
      responses:
        '200':
          description: 成功

  # ========== DFX-014: 路径参数缺少最小值校验 ==========
  /users/{id}:
    get:
      summary: 根据ID获取用户 - 路径参数数值问题
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            # 缺少 minimum: 1
      responses:
        '200':
          description: 成功

  /users/{userCode}:
    get:
      summary: 根据编码获取用户 - 路径参数字符串问题
      operationId: getUserByCode
      parameters:
        - name: userCode
          in: path
          required: true
          description: 用户编码
          schema:
            type: string
            # 缺少 minLength: 1
      responses:
        '200':
          description: 成功

  # ========== 完整示例: 包含header和cookie参数 ==========
  /users/{id}/profile:
    get:
      summary: 获取用户资料 - 完整参数示例
      operationId: getUserProfile
      parameters:
        - name: id
          in: path
          required: true
          description: 用户ID
          schema:
            type: integer
            minimum: 1
        - name: X-Token
          in: header
          required: true
          description: 认证令牌
          schema:
            type: string
            minLength: 1
            maxLength: 255
        - name: JSESSIONID
          in: cookie
          description: 会话ID
          schema:
            type: string
            minLength: 1
            maxLength: 64
      responses:
        '200':
          description: 成功

  # ========== 创建用户 - 完整请求体示例 ==========
  /users/create:
    post:
      summary: 创建用户 - RequestBody示例
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - phone
                - age
              properties:
                username:
                  type: string
                  minLength: 4
                  maxLength: 20
                  description: 用户名
                email:
                  type: string
                  format: email
                  description: 邮箱
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                  description: 手机号
                age:
                  type: integer
                  minimum: 0
                  maximum: 150
                  description: 年龄
                score:
                  type: number
                  minimum: 0
                  maximum: 100
                  description: 评分
                price:
                  type: number
                  minimum: 0
                  description: 价格
                balance:
                  type: number
                  minimum: 0
                  description: 余额
                tags:
                  type: array
                  minItems: 1
                  maxItems: 10
                  items:
                    type: string
                  description: 标签列表
                birthday:
                  type: string
                  format: date
                  description: 生日
                enabled:
                  type: boolean
                  description: 是否启用
      responses:
        '201':
          description: 创建成功

  # ========== 使用 definitions 的示例 - 测试字段变更 ==========
  # 此 API 使用 $ref 引用 definitions 中的模型
  # 用于测试"字段变更"功能的检测
  /model/user:
    get:
      summary: 获取用户模型信息
      operationId: getUserModel
      responses:
        '200':
          description: 成功
          schema:
            $ref: '#/definitions/UserModel'

  /model/users:
    post:
      summary: 创建用户模型
      operationId: createUserModel
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/UserModel'
      responses:
        '200':
          description: 成功

  # ========== 自定义注解场景 - x-java-class-annotations ==========
  # 场景1: 类级别注解（path级别）
  /admin/users:
    x-java-class-annotations:
      - "@Secured"
      - "@AuditLog(action='USER_QUERY')"
    get:
      summary: 获取用户列表 - 带类注解
      operationId: getAdminUsers
      x-java-method-annotations:
        - "@Permission('admin:user:read')"
        - "@RateLimiter(maxRequests=100)"
      responses:
        '200':
          description: 成功

  # 场景2: 方法级别注解（operation级别）
  /admin/users/{id}:
    get:
      summary: 获取用户详情 - 仅有方法注解
      operationId: getAdminUserById
      x-java-method-annotations:
        - "@Permission('admin:user:read')"
        - "@Cacheable(key='#id')"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: 成功

  # 场景3: 同一路径下多个方法，类注解一致（正常场景）
  /secure:
    x-java-class-annotations:
      - "@Secured"
      - "@RequireRole('ADMIN')"
    get:
      summary: 获取安全配置 - GET
      operationId: getSecureConfig
      x-java-method-annotations:
        - "@AuditLog(action='SECURE_GET')"
      responses:
        '200':
          description: 成功
    post:
      summary: 更新安全配置 - POST
      operationId: updateSecureConfig
      x-java-method-annotations:
        - "@AuditLog(action='SECURE_UPDATE')"
        - "@Transactional"
      responses:
        '200':
          description: 成功

  # 场景4: 同一路径下类注解不一致（异常场景 - DFX-020）
  /inconsistent:
    x-java-class-annotations:
      - "@Secured"
    get:
      summary: 获取资源 - GET
      operationId: getInconsistent
      x-java-class-annotations:
        - "@DifferentAnnotation"  # 异常：与path级别注解不一致
      responses:
        '200':
          description: 成功
    post:
      summary: 创建资源 - POST
      operationId: createInconsistent
      # 异常：POST方法没有类注解，但GET有
      responses:
        '201':
          description: 创建成功

  # ========== DFX-009: minLength > maxLength 错误 ==========
  /api/invalid-length:
    get:
      summary: 搜索 - 长度范围错误
      operationId: searchInvalidLength
      parameters:
        - name: keyword
          in: query
          description: 搜索关键词
          schema:
            type: string
            minLength: 100
            maxLength: 10
      responses:
        '200':
          description: 成功

  # ========== DFX-010: min > max 错误 ==========
  /api/invalid-range:
    get:
      summary: 查询 - 数值范围错误
      operationId: queryInvalidRange
      parameters:
        - name: age
          in: query
          description: 年龄
          schema:
            type: integer
            minimum: 100
            maximum: 10
      responses:
        '200':
          description: 成功

  # ========== WARN: 必填参数缺少 description ==========
  /api/missing-description:
    get:
      summary: 查询 - 必填参数缺少描述
      operationId: queryMissingDesc
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 成功

  # ========== INFO: 邮箱字段建议添加 @Email ==========
  /api/suggest-email:
    post:
      summary: 注册 - 邮箱字段建议
      operationId: registerUser
      parameters:
        - name: email
          in: query
          description: 邮箱地址
          schema:
            type: string
            # 缺少 format: email，但字段名包含 email
      responses:
        '200':
          description: 成功

  # ========== INFO: 电话字段建议添加正则 ==========
  /api/suggest-phone:
    post:
      summary: 绑定手机号 - 电话字段建议
      operationId: bindPhone
      parameters:
        - name: mobile
          in: query
          description: 手机号
          schema:
            type: string
            # 缺少 pattern，但字段名包含 mobile
      responses:
        '200':
          description: 成功

  # ========== INFO: 生日字段建议添加 @Past ==========
  /api/suggest-birthday:
    post:
      summary: 设置生日 - 生日字段建议
      operationId: setBirthday
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                birthday:
                  type: string
                  format: date
                  description: 生日日期
                  # 字段名包含 birthday，但缺少 past: true
                dob:
                  type: string
                  format: date
                  description: 出生日期
      responses:
        '200':
          description: 成功

  # ========== INFO: 预约字段建议添加 @Future ==========
  /api/suggest-appointment:
    post:
      summary: 预约 - 预约字段建议
      operationId: createAppointment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                scheduleTime:
                  type: string
                  format: date-time
                  description: 预约时间
                appointmentDate:
                  type: string
                  format: date
                  description: 预约日期
      responses:
        '200':
          description: 成功
