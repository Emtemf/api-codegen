# Swagger 2.0 示例
# 用户管理 API 定义
#
# 说明：
# - 本项目会自动检测 Swagger/OpenAPI 格式并转换为自定义格式
# - 使用 Java 运行：java -jar api-codegen.jar swagger2-example.yaml
# - 使用 Maven 运行：mvn api-codegen:generate -DyamlFile=swagger2-example.yaml
#
# 本文件包含以下问题类型：
# - 路径包含 // (错误)
# - 路径不以 / 开头 (错误)
# - 缺少 operationId (警告)
# - 缺少参数 description (警告)
# - 缺少 requestBody description (警告)
# - 缺少成功响应 (警告)

swagger: '2.0'
info:
  version: v1
  title: 用户管理 API
  description: 用户相关的 API 接口，包括创建、查询、更新、删除用户
  contact:
    name: API Support
    email: support@example.com
schemes:
  - https
basePath: /api/v1

# ========== 有效的 API ==========
paths:
  /users:
    get:
      summary: 获取用户列表
      description: 分页获取用户列表，支持按用户名搜索
      operationId: getUserList
      tags:
        - User
      parameters:
        - name: page
          in: query
          type: integer
          description: 页码（从1开始）
          default: 1
        - name: size
          in: query
          type: integer
          description: 每页数量
          default: 10
        - name: username
          in: query
          type: string
          description: 用户名（模糊搜索）
      responses:
        '200':
          description: 成功
          schema:
            type: object
            properties:
              code:
                type: integer
                description: 响应码
              message:
                type: string
                description: 响应消息
              data:
                type: array
                items:
                  $ref: '#/definitions/User'

    post:
      summary: 创建用户
      description: 创建新用户
      operationId: createUser
      tags:
        - User
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/CreateUserRequest'
      responses:
        '200':
          description: 创建成功
          schema:
            $ref: '#/definitions/UserResponse'

  /users/{id}:
    get:
      summary: 获取用户详情
      description: 根据用户ID获取用户详情
      operationId: getUserById
      tags:
        - User
      parameters:
        - name: id
          in: path
          type: integer
          required: true
          description: 用户ID
      responses:
        '200':
          description: 成功
          schema:
            $ref: '#/definitions/UserResponse'

    put:
      summary: 更新用户
      description: 更新用户信息
      operationId: updateUser
      tags:
        - User
      parameters:
        - name: id
          in: path
          type: integer
          required: true
          description: 用户ID
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/UpdateUserRequest'
      responses:
        '200':
          description: 更新成功
          schema:
            $ref: '#/definitions/UserResponse'

    delete:
      summary: 删除用户
      description: 删除指定用户
      operationId: deleteUser
      tags:
        - User
      parameters:
        - name: id
          in: path
          type: integer
          required: true
          description: 用户ID
      responses:
        '200':
          description: 删除成功
          schema:
            type: object
            properties:
              success:
                type: boolean
                description: 操作是否成功

  # ========== 问题1: 路径包含 // ==========
  /XXX/users/detail:
    get:
      summary: 用户详情
      # 缺少 operationId - 警告
      parameters:
        - name: id
          in: query
          required: true
          # 缺少 description - 警告
      responses:
        '200':
          description: Success

  # ========== 问题2: 路径不以 / 开头 ==========
  users/profile:
    get:
      summary: 用户资料
      operationId: getUserProfile
      responses:
        '200':
          description: Success
      # 缺少成功响应 - 警告

  # ========== 问题3: 多个 // 路径 ==========
  /api/v1/message:
    get:
      summary: 获取消息
      operationId: getMessage
      responses:
        '200':
          description: Success

  /api/v1/messageStatus:
    get:
      summary: 获取消息状态
      operationId: getMessageStatus
      responses:
        '200':
          description: Success

  /api/v1/messageUnreadTotal:
    get:
      summary: 获取未读总数
      operationId: getUnreadTotal
      responses:
        '200':
          description: Success

  # ========== 问题4: 缺少 operationId ==========
  /users/search:
    get:
      summary: 搜索用户
      # 缺少 operationId - 警告
      parameters:
        - name: keyword
          in: query
          type: string
          # 缺少 description - 警告
      responses:
        '200':
          description: Success

  # ========== 问题5: 缺少 requestBody description ==========
  /users/import:
    post:
      summary: 导入用户
      operationId: importUsers
      # 缺少 requestBody - 警告
      responses:
        '200':
          description: Success

definitions:
  User:
    type: object
    description: 用户信息
    properties:
      id:
        type: integer
        description: 用户ID
      username:
        type: string
        description: 用户名
      email:
        type: string
        format: email
        description: 邮箱
      phone:
        type: string
        description: 手机号
      age:
        type: integer
        description: 年龄
      status:
        type: string
        description: 用户状态
        enum: [ACTIVE, INACTIVE]
      createdAt:
        type: string
        format: date-time
        description: 创建时间

  CreateUserRequest:
    type: object
    required:
      - username
      - email
    properties:
      username:
        type: string
        minLength: 4
        maxLength: 20
        description: 用户名
      email:
        type: string
        format: email
        description: 邮箱
      phone:
        type: string
        pattern: '^1[3-9]\d{9}$'
        description: 手机号
      age:
        type: integer
        minimum: 0
        maximum: 150
        description: 年龄

  UpdateUserRequest:
    type: object
    properties:
      username:
        type: string
        description: 用户名
      email:
        type: string
        format: email
        description: 邮箱
      phone:
        type: string
        description: 手机号
      status:
        type: string
        enum: [ACTIVE, INACTIVE]
        description: 用户状态

  UserResponse:
    type: object
    properties:
      code:
        type: integer
        description: 响应码
      message:
        type: string
        description: 响应消息
      data:
        $ref: '#/definitions/User'
